<!DOCTYPE html>
<html lang="en">

<head>

  <title>Document</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>
  <link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
  <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

</head>


<body align="center">



  <nav class="navbar" style="
    background-color: #101f37;
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
 ">

    <a class="navbar-brand" href="/userHome">
      <img src="https://cdn.discordapp.com/attachments/884628154864525332/956249108564299776/unknown.png"
        class="img-fluid" style="
    width: 120px;
    height: 50px;
    object-fit: cover;
    padding-left:20px;

    ">
    </a>

    <ul class="nav justify-content-end" style="padding-right: 10px;">


      <div class="d-flex" style="padding-right:10px">
        <img src="https://www.pinclipart.com/picdir/big/200-2008697_account-customer-login-man-user-icon-login-icon.png"
          class="img-fluid" alt="Responsive image" style="

       width: 40px;
        height: 40px;

        ">
      </div>

      <li class="nav-item dropdown" style="padding-right: 100px">
        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
          aria-haspopup="true" aria-expanded="false" style="color: rgb(255, 255, 255);">
          <%= username %>
        </a>
        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
          <a class="dropdown-item" href="/accountDetails">Account Details</a>
          <a class="dropdown-item" href="/cart">Cart ðŸ›’</a>
          <div class="dropdown-divider"></div>
          <a class="dropdown-item" href="/logOut">Log Out </a>
        </div>
      </li>



    </ul>
  </nav>

  <div class="d-flex justify-content-center" style="
  height: 130px;
  background: rgb(135, 206, 235);

  ">
    <!-- background: linear-gradient(90deg, rgb(76, 170, 177) 0%, rgb(25, 131, 163) 35%, rgb(16, 135, 139) 100%); -->
    <div class="container" style="padding-top: 20px;padding-left: 600px;">

      <form action="/search" method="post">
        <div class="search"> <i class="fa fa-search"></i> <input name="searchText" type="text" class="form-control"
            placeholder="Search Products...">
          <div class="d-flex" style="padding-top: 10px;">
            <div style="color: white;
            text-shadow: 2px 2px 4px #000000;
             box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.2), 0 3px 10px 0 rgba(0, 0, 0, 0.19);">

              <button class="btn btn-primary">Search</button>
            </div>

          </div>

        </div>
      </form>



    </div>
    <div class="container-fluid" style="padding-top: 20px; ">
      <div class="dropdown">

        <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown"
          aria-haspopup="true" aria-expanded="false" style="color:white;color: white;

           box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.2), 0 3px 10px 0 rgba(0, 0, 0, 0.19);">
          Filter
        </button>

        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          <form action="/filter-gp" method="post">
            <button name="giftCards" class="dropdown-item" href="">Gift Cards</button>
          </form>
          <form action="/filter-sp" method="post">
            <button name="subscription" class="dropdown-item" href="">Subscription</button>

          </form>
          <form action="/filter-tp" method="post">
            <button name="topUp" class="dropdown-item" href="">Top Up</button>

          </form>
          <form action="/filter-cp" method="post">
            <button name="cdKeys" class="dropdown-item" href="">CD Keys</button>

          </form>
          <form action="/filter-op" method="post">
            <button name="others" class="dropdown-item" href="">others</button>

          </form>


        </div>
      </div>
    </div>



  </div>

  <div class="container">

    <br>

    <div class="row">
      <% for(let i=0; i < data.length; i++) { %>
        <div class="col-md-4">
          <figure class="card card-product">
            <div class="img-wrap"><img class="img-responsive" style="width: 100%;height: 500px;" src=<%=data[i].image %>
              >
            </div>
            <figcaption class="info-wrap" style="padding-left: 30px">
              <h4 class="title">
                <%= data[i].name %>
              </h4>
              <p class="desc">
                <%= data[i].tag %>
              </p>
              <div class="rating-wrap">

              </div> <!-- rating-wrap.// -->
            </figcaption>

            <div class="container-fluid" style="padding-bottom:20px">

              <div class="container-fluid">
                <button href="" class="btn btn-sm btn-primary float-right" onclick="addToCart(this)"
                  data-name="<%= data[i].name %>" data-id="<%= data[i].id %>">Add to
                  Cart</button>
              </div>

              <div class=" container-fluid">
                <div class="price-wrap h5">
                  <span class="price-new">

                    <%=data[i].price %>$
                  </span>
                </div>
              </div>
              <!-- price-wrap.// -->
            </div> <!-- bottom-wrap.// -->
          </figure>
        </div> <!-- col // -->
        <% } %>
    </div> <!-- row.// -->
  </div>

  <div id='toastContainer' class="position-fixed bottom-0 end-0 p-3 d-flex flex-column gap-2" style="z-index: 11">
  </div>


  <script>
    // work().then(res => {res.id})

    // async root () => {
    //   const res = await work()

    //   res.id
    // }
    const addToCart = async (e) => {
      const id = e.dataset.id
      const name = e.dataset.name

      const toastId = (new Date()).getTime()

      document.querySelector("#toastContainer").innerHTML += `
        <div id="${toastId}" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="false">
          <div class="toast-header">
            <strong class="me-auto">Cart</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
          <div class="toast-body">
            You have added <b>${name}</b>
          </div>
        </div>
      `

      const toast = new bootstrap.Toast(document.getElementById(toastId));
      toast.show();

      const response = await fetch('/addToCart', {
        method: 'POST',
        mode: 'cors',
        credentials: 'same-origin',
        headers: {
          'Content-Type': 'application/json'
        },
        redirect: 'follow',
        referrerPolicy: 'no-referrer',
        body: JSON.stringify({ id })
      });
    }
    let option = {
      animation: true,
      delay: 2000
    }

    const toast = () => {

      let toastElement = document.getElementById("toast")
      let toastCall = new bootstrap.Toast(toastElement, option)

      toastCall.show()

    }

  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous">
    </script>


</body>

</html>
